import{createRef as n,useRef as t,useMemo as i,useEffect as r}from"react";import{PanResponder as e}from"react-native";var a=function(){return a=Object.assign||function(n){for(var t,i=1,r=arguments.length;i<r;i++)for(var e in t=arguments[i])Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n},a.apply(this,arguments)};function o(n,t,i){if(i||2===arguments.length)for(var r,e=0,a=t.length;e<a;e++)!r&&e in t||(r||(r=Array.prototype.slice.call(t,0,e)),r[e]=t[e]);return n.concat(r||Array.prototype.slice.call(t))}function u(){return Date.now()}function s(n){return function(t){t.nativeEvent&&(t=t.nativeEvent);var i=t.changedTouches||[],r=t.targetTouches||[],e=t.detail&&t.detail.x?t.detail:null;return n({id:e?e.identifier?e.identifier:"i":r[0]?r[0]?r[0].identifier:"e":"d",idChanged:e?e.identifier?e.identifier:"i":i[0]?i[0]?i[0].identifier:"e":"d",raw:t,x:e&&e.x?e.x:r[0]?r[0].screenX:e?e.x:t.pageX,y:e&&e.y?e.y:r[0]?r[0].screenY:e?e.y:t.pageY})}}function c(n,t,i){return Math.min(Math.max(n,t),i)}function d(n){return(n>0?1:0)-(n<0?1:0)||+n}function l(n,t,i,r){var e=n&&n[t];return null==e?i:r&&"function"==typeof e?e():e}function f(n){return Math.round(1e6*n)/1e6}function p(n,t){if(n===t)return!0;var i=typeof n;if(i!==typeof t)return!1;if("object"!==i||null===n||null===t)return"function"===i&&n.toString()===t.toString();if(n.length!==t.length||Object.getOwnPropertyNames(n).length!==Object.getOwnPropertyNames(t).length)return!1;for(var r in n)if(!p(n[r],t[r]))return!1;return!0}function v(n,t){return p(n.current,t)||(n.current=t),n.current}function h(n){var t,i,r,e,a,o;function u(t){o||(o=t),s(!0);var a=t-o;a>r&&(a=r);var l=e[i];if(l[3]<a)return i++,u(t);var f=l[2],p=l[4],v=l[0],h=l[1]*(0,l[5])(0===p?1:(a-f)/p);if(h&&n.track.to(v+h),a<r)return d();o=null,s(!1),c(null),n.emit("animationEnded")}function s(n){t.active=n}function c(n){t.targetIdx=n}function d(){var n;n=u,a=window.requestAnimationFrame(n)}function l(){var t;t=a,window.cancelAnimationFrame(t),s(!1),c(null),o&&n.emit("animationStopped"),o=null}return t={active:!1,start:function(t){if(l(),n.track.details){var a=0,o=n.track.details.position;i=0,r=0,e=t.map((function(n){var t,i=o,e=null!==(t=n.earlyExit)&&void 0!==t?t:n.duration,u=n.easing,s=n.distance*u(e/n.duration)||0;o+=s;var c=r;return r+=e,a+=s,[i,n.distance,c,r,n.duration,u]})),c(n.track.distToIdx(a)),d(),n.emit("animationStarted")}},stop:l,targetIdx:null}}function m(n){var t,i,r,e,a,s,p,v,h,m,g,b,x,y=1/0,M=[],k=null,T=0;function w(n){R(T+n)}function P(n){var t=C(T+n).abs;return I(t)?t:null}function C(n){var t=Math.floor(Math.abs(n/i)),r=(n%i+i)%i,e=d(n),a=p.indexOf(o([],p,!0).reduce((function(n,t){return Math.abs(t-r)<Math.abs(n-r)?t:n}))),u=a;return e<0&&0!==r&&t++,a===s&&(u=0,t+=e>0?1:-1),{abs:u+t*s*e,origin:a,rel:u}}function z(n,t,i){var r;if(t||!S())return E(n,i);if(!I(n))return null;var e=C(null!=i?i:T),a=e.abs,o=n-e.rel,u=a+o;r=E(u);var c=E(u-s*Math.sign(o));return(null!==c&&Math.abs(c)<Math.abs(r)||null===r)&&(r=c),f(r)}function E(n,t){if(null==t&&(t=f(T)),!I(n)||null===n)return null;n=Math.round(n);var r=C(t),e=r.abs,a=r.rel,o=r.origin,u=D(n),c=(t%i+i)%i,d=p[o],l=Math.floor((n-(e-a))/s)*i;return f(d-c-d+p[u]+l+(o===s?i:0))}function I(n){return O(n)===n}function O(n){return c(n,v,h)}function S(){return e.loop}function D(n){return(n%s+s)%s}function R(t){var i;i=t-T,M.push({distance:i,timestamp:u()}),M.length>6&&(M=M.slice(-6)),T=Math.round(1e6*t)/1e6;var r=j().abs;if(r!==k){var e=null!==k;k=r,e&&n.emit("slideChanged")}}function j(o){var u=o?null:function(){if(s){var n=S(),t=n?(T%i+i)%i:T,o=(n?T%i:T)-a[0][2],u=0-(o<0&&n?i-Math.abs(o):o),c=0,l=C(T),f=l.abs,p=l.rel,y=a[p][2],M=a.map((function(t,r){var a=u+c;(a<0-t[0]||a>1)&&(a+=(Math.abs(a)>i-1&&n?i:0)*d(-a));var o=r-p,l=Math.sign(o),v=o+f;n&&(-1===l&&a>y&&(v+=s),1===l&&a<y&&(v-=s),null!==m&&v<m&&(a+=i),null!==g&&v>g&&(a-=i));var h=a+t[0]+t[1],b=Math.max(a>=0&&h<=1?1:h<0||a>1?0:a<0?Math.min(1,(t[0]+a)/t[0]):(1-a)/t[0],0);return c+=t[0]+t[1],{abs:v,distance:e.rtl?-1*a+1-t[0]:a,portion:b,size:t[0]}}));return f=O(f),p=D(f),{abs:O(f),length:r,max:x,maxIdx:h,min:b,minIdx:v,position:T,progress:n?t/i:T/r,rel:p,slides:M}}}();return t.details=u,n.emit("detailsChanged"),u}return t={absToRel:D,add:w,details:null,distToIdx:P,idxToDist:z,init:function(t){if(function(){if(e=n.options,a=(e.trackConfig||[]).map((function(n){return[l(n,"size",1),l(n,"spacing",0),l(n,"origin",0)]})),s=a.length){i=f(a.reduce((function(n,t){return n+t[0]+t[1]}),0));var t=s-1;r=f(i+a[0][2]-a[t][0]-a[t][2]-a[t][1]),(p=a.reduce((function(n,t){if(!n)return[0];var i=a[n.length-1],r=n[n.length-1]+(i[0]+i[2])+i[1];return r-=t[2],n[n.length-1]>r&&(r=n[n.length-1]),n.push(r),n}),null)).push(i)}}(),!s)return j(!0);var o;!function(){var t=n.options.range,i=n.options.loop;m=v=i?l(i,"min",-1/0):0,g=h=i?l(i,"max",y):a.length-1;var r=l(t,"min",null),e=l(t,"max",null);r&&(v=r),e&&(h=e),b=v===-1/0?v:n.track.idxToDist(v||0,!0,0),x=h===y?h:z(h,!0,0),null===e&&(g=h),l(t,"align",!1)&&h!==y&&0===a[D(h)][2]&&(x-=1-a[D(h)][0],h=P(x)),b=f(b),x=f(x)}(),o=t,Number(o)===o?w(E(O(t))):j()},to:R,velocity:function(){var n=u(),t=M.reduce((function(t,i){var r=i.distance,e=i.timestamp;return n-e>200||(d(r)!==d(t.distance)&&t.distance&&(t={distance:0,lastTimestamp:0,time:0}),t.time&&(t.distance+=r),t.lastTimestamp&&(t.time+=e-t.lastTimestamp),t.lastTimestamp=e),t}),{distance:0,lastTimestamp:0,time:0});return t.distance/t.time||0}}}function g(n){var t,i,r,e,a,o,u;function s(n){return 2*n}function l(n){return c(n,o,u)}function f(n){return 1-Math.pow(1-n,3)}function p(){m();var t="free-snap"===n.options.mode,i=n.track,o=i.velocity();r=d(o);var u=n.track.details,c=[];if(o||!t){var p=v(o),h=p.dist,g=p.dur;if(g=s(g),h*=r,t){var b=i.idxToDist(i.distToIdx(h),!0);b&&(h=b)}c.push({distance:h,duration:g,easing:f});var x=u.position,y=x+h;if(y<e||y>a){var M=y<e?e-x:a-x,k=0,T=o;if(d(M)===r){var w=Math.min(Math.abs(M)/Math.abs(h),1),P=function(n){return 1-Math.pow(1-n,1/3)}(w)*g;c[0].earlyExit=P,T=o*(1-w)}else c[0].earlyExit=0,k+=M;var C=v(T,100),z=C.dist*r;n.options.rubberband&&(c.push({distance:z,duration:s(C.dur),easing:f}),c.push({distance:-z+k,duration:500,easing:f}))}n.animator.start(c)}else n.moveToIdx(l(u.abs),!0,{duration:500,easing:function(n){return 1+--n*n*n*n*n}})}function v(n,t){void 0===t&&(t=1e3);var i=147e-9+(n=Math.abs(n))/t;return{dist:Math.pow(n,2)/i,dur:n/i}}function h(){var t=n.track.details;t&&(e=t.min,a=t.max,o=t.minIdx,u=t.maxIdx)}function m(){n.animator.stop()}n.on("updated",h),n.on("optionsChanged",h),n.on("created",h),n.on("dragStarted",(function(){m(),t=i=n.track.details.abs})),n.on("dragEnded",(function(){var r=n.options.mode;"snap"===r&&function(){var r=n.track,o=n.track.details,u=o.position,s=d(r.velocity());(u>a||u<e)&&(s=0);var c=t+s;0===o.slides[r.absToRel(c)].portion&&(c-=s),t!==i&&(c=i),d(r.idxToDist(c,!0))!==s&&(c+=s),c=l(c);var f=r.idxToDist(c,!0);n.animator.start([{distance:f,duration:500,easing:function(n){return 1+--n*n*n*n*n}}])}(),"free"!==r&&"free-snap"!==r||p()})),n.on("dragged",(function(){i=n.track.details.abs}))}function b(n){var t,i,r,a,o,u,l,f,p,v,h,m;function g(t){a&&u===t.idChanged&&(a=!1,n.emit("dragEnded"))}function b(t){var i=n.options.vertical,r=i?t.y:t.x,e=i?t.x:t.y,a=void 0!==p&&void 0!==v&&Math.abs(v-e)<=Math.abs(p-r);return p=r,v=e,a}function x(t){return n.options.vertical?t.y:t.x}function y(){var t;!function(){r=n.size;var t=n.track.details;t&&(h=t.min,m=t.max)}(),t=n.options.dragSpeed||1,o="function"==typeof t?t:function(n){return n*t},i=n.options.rtl?-1:1}n.on("updated",y),n.on("layoutChanged",y),n.on("created",y);var M=e.create({onPanResponderMove:s((function(e){if(a&&u===e.idChanged){var s=x(e);if(l){if(!b(e))return g(e);n.emit("dragChecked"),l=!1}var p=function(i){if(h===-1/0&&m===1/0)return i;var e=n.track.details,a=e.length,o=e.position,u=c(i,h-o,m-o);if(0===a)return 0;if(!n.options.rubberband)return u;if(o<=m&&o>=h)return i;if(o<h&&t>0||o>m&&t<0)return i;var s=(o<h?o-h:o-m)/a,d=r*a,l=Math.abs(s*d),f=Math.max(0,1-l/r*2);return f*f*i}(o(f-s)/n.size*i);t=d(p),n.track.add(p),f=s,n.emit("dragged")}})),onPanResponderRelease:s(g),onPanResponderTerminate:s(g),onStartShouldSetPanResponder:s((function(t){if(!a&&n.track.details&&n.track.details.length&&n.options.drag)return a=!0,l=!0,u=t.idChanged,b(t),f=x(t),n.emit("dragStarted"),!0}))});Object.assign(n.containerProps,M.panHandlers)}function x(t){return function(i){function r(n){i.animator.stop();var t=i.track.details;i.track.init(null!=n?n:t?t.abs:0)}function e(){var t=i.options.slides;if("function"==typeof t)return i.options.trackConfig=t(i.size);for(var r="number"==typeof t?t:l(t,"number",0,!0),e=[],a=l(t,"perView",1,!0),o=l(t,"spacing",0,!0)/i.size||0,u=o/a,s=l(t,"origin","auto"),c=0,d=0;d<r;d++){var f=1/a-o+u,p="center"===s?.5-f/2:"auto"===s?0:s;e.push({origin:p,size:f,spacing:o}),c+=f}if(c+=o*(r-1),"auto"===s&&!i.options.loop&&1!==a){var v=0;e.map((function(n){var t=c-v;return v+=n.size+o,t>=1||(n.origin=1-t-(c>1?0:1-c)),n}))}i.options.trackConfig=e,function(t){var r,e=i.slidesProps.length;if(e!==t){var a=t-e;a>0?(r=i.slidesProps).push.apply(r,Array(a).fill(null).map((function(){return{ref:n()}}))):i.slidesProps.splice(a)}}(i.options.trackConfig.length)}i.containerProps={onLayout:function(n){var t=i.options.vertical?n.nativeEvent.layout.height:n.nativeEvent.layout.width;t!==i.size&&(i.size=t,e(),r(),i.emit("layoutChanged"))}},i.slidesProps=[],i.update=function(n,o){n&&(i.options=a(a({},t),n)),e(),r(o),i.emit("updated")},i.options=a(a({},t),i.options),e(),function(n){function t(){n.track.details&&n.track.details.slides.forEach((function(t,i){var r=n.options.vertical?"100%":"".concat(100*t.size,"%"),e=n.options.vertical?"".concat(100*t.size,"%"):"100%",a=n.size?t.distance*n.size:100*t.distance+"%",o=n.options.vertical?0:a,u=n.options.vertical?a:0,s="absolute";n.slidesProps[i].style={height:e,left:o,position:s,top:u,width:r};var c=n.slidesProps[i].ref.current;c&&c.setNativeProps({style:{height:e,left:o,position:s,top:u,width:r}})}))}n.on("detailsChanged",t),n.on("created",t),n.on("updated",t)}(i),b(i)}}var y=function(n,t){try{return function(n,t){var i,r={};return i={emit:function(n){r[n]&&r[n].forEach((function(n){n(i)}));var t=i.options[n];t&&t(i)},moveToIdx:function(n,t,r){var e=i.track.idxToDist(n,t);if(e){var a=i.options.defaultAnimation;i.animator.start([{distance:e,duration:l(r||a,"duration",500),easing:l(r||a,"easing",(function(n){return 1+--n*n*n*n*n}))}])}},on:function(n,t,i){void 0===i&&(i=!1),r[n]||(r[n]=[]);var e=r[n].indexOf(t);e>-1?i&&delete r[n][e]:i||r[n].push(t)},options:n},function(){if(i.track=m(i),i.animator=h(i),t)for(var n in t){var r=t[n];r&&r(i)}i.track.init(i.options.initial||0),i.emit("created")}(),i}(n,o([x({drag:!0,mode:"snap",rubberband:!0}),g],t||[],!0))}catch(n){console.error(n)}};function M(n,e){var a=t(!1),o=t(n),u=i((function(){return y(n,e)}),[]);return r((function(){a.current?u&&u.update(o.current):a.current=!0}),[v(o,n)]),u}export{y as default,M as useKeenSliderNative};
