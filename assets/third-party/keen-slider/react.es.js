import{useRef as n,useCallback as t,useEffect as i}from"react";function e(n){return Array.prototype.slice.call(n)}function r(){return Date.now()}function a(n,t,i){if(t="data-keen-slider-"+t,null===i)return n.removeAttribute(t);n.setAttribute(t,i||"")}function o(n,t){return t=t||document,"function"==typeof n&&(n=n(t)),Array.isArray(n)?n:"string"==typeof n?e(t.querySelectorAll(n)):n instanceof HTMLElement?[n]:n instanceof NodeList?e(n):[]}function u(n){n.raw&&(n=n.raw),n.cancelable&&!n.defaultPrevented&&n.preventDefault()}function c(n){n.raw&&(n=n.raw),n.stopPropagation&&n.stopPropagation()}function s(){var n=[];return{add:function(t,i,e,r){t.addListener?t.addListener(e):t.addEventListener(i,e,r),n.push([t,i,e,r])},input:function(n,t,i,e){this.add(n,t,function(n){return function(t){t.nativeEvent&&(t=t.nativeEvent);var i=t.changedTouches||[],e=t.targetTouches||[],r=t.detail&&t.detail.x?t.detail:null;return n({id:r?r.identifier?r.identifier:"i":e[0]?e[0]?e[0].identifier:"e":"d",idChanged:r?r.identifier?r.identifier:"i":i[0]?i[0]?i[0].identifier:"e":"d",raw:t,x:r&&r.x?r.x:e[0]?e[0].screenX:r?r.x:t.pageX,y:r&&r.y?r.y:e[0]?e[0].screenY:r?r.y:t.pageY})}}(i),e)},purge:function(){n.forEach((function(n){n[0].removeListener?n[0].removeListener(n[2]):n[0].removeEventListener(n[1],n[2],n[3])})),n=[]}}}function d(n,t,i){return Math.min(Math.max(n,t),i)}function l(n){return(n>0?1:0)-(n<0?1:0)||+n}function f(n){return n.getBoundingClientRect()}function p(n,t,i,e){var r=n&&n[t];return null==r?i:e&&"function"==typeof r?r():r}function v(n){return Math.round(1e6*n)/1e6}function m(n,t){if(n===t)return!0;var i=typeof n;if(i!==typeof t)return!1;if("object"!==i||null===n||null===t)return"function"===i&&n.toString()===t.toString();if(n.length!==t.length||Object.getOwnPropertyNames(n).length!==Object.getOwnPropertyNames(t).length)return!1;for(var e in n)if(!m(n[e],t[e]))return!1;return!0}function h(n,t){return m(n.current,t)||(n.current=t),n.current}var g=function(){return g=Object.assign||function(n){for(var t,i=1,e=arguments.length;i<e;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},g.apply(this,arguments)};function b(n,t,i){if(i||2===arguments.length)for(var e,r=0,a=t.length;r<a;r++)!e&&r in t||(e||(e=Array.prototype.slice.call(t,0,r)),e[r]=t[r]);return n.concat(e||Array.prototype.slice.call(t))}function y(n){var t,i,e,r,a,o;function u(t){o||(o=t),c(!0);var a=t-o;a>e&&(a=e);var l=r[i];if(l[3]<a)return i++,u(t);var f=l[2],p=l[4],v=l[0],m=l[1]*(0,l[5])(0===p?1:(a-f)/p);if(m&&n.track.to(v+m),a<e)return d();o=null,c(!1),s(null),n.emit("animationEnded")}function c(n){t.active=n}function s(n){t.targetIdx=n}function d(){var n;n=u,a=window.requestAnimationFrame(n)}function l(){var t;t=a,window.cancelAnimationFrame(t),c(!1),s(null),o&&n.emit("animationStopped"),o=null}return t={active:!1,start:function(t){if(l(),n.track.details){var a=0,o=n.track.details.position;i=0,e=0,r=t.map((function(n){var t,i=o,r=null!==(t=n.earlyExit)&&void 0!==t?t:n.duration,u=n.easing,c=n.distance*u(r/n.duration)||0;o+=c;var s=e;return e+=r,a+=c,[i,n.distance,s,e,n.duration,u]})),s(n.track.distToIdx(a)),d(),n.emit("animationStarted")}},stop:l,targetIdx:null}}function x(n){var t,i,e,a,o,u,c,s,f,m,h,g,y,x=1/0,k=[],w=null,M=0;function T(n){O(M+n)}function C(n){var t=E(M+n).abs;return A(t)?t:null}function E(n){var t=Math.floor(Math.abs(n/i)),e=(n%i+i)%i,r=l(n),a=c.indexOf(b([],c,!0).reduce((function(n,t){return Math.abs(t-e)<Math.abs(n-e)?t:n}))),o=a;return r<0&&0!==e&&t++,a===u&&(o=0,t+=r>0?1:-1),{abs:o+t*u*r,origin:a,rel:o}}function z(n,t,i){var e;if(t||!S())return I(n,i);if(!A(n))return null;var r=E(null!=i?i:M),a=r.abs,o=n-r.rel,c=a+o;e=I(c);var s=I(c-u*Math.sign(o));return(null!==s&&Math.abs(s)<Math.abs(e)||null===e)&&(e=s),v(e)}function I(n,t){if(null==t&&(t=v(M)),!A(n)||null===n)return null;n=Math.round(n);var e=E(t),r=e.abs,a=e.rel,o=e.origin,s=L(n),d=(t%i+i)%i,l=c[o],f=Math.floor((n-(r-a))/u)*i;return v(l-d-l+c[s]+f+(o===u?i:0))}function A(n){return D(n)===n}function D(n){return d(n,s,f)}function S(){return a.loop}function L(n){return(n%u+u)%u}function O(t){var i;i=t-M,k.push({distance:i,timestamp:r()}),k.length>6&&(k=k.slice(-6)),M=Math.round(1e6*t)/1e6;var e=P().abs;if(e!==w){var a=null!==w;w=e,a&&n.emit("slideChanged")}}function P(r){var c=r?null:function(){if(u){var n=S(),t=n?(M%i+i)%i:M,r=(n?M%i:M)-o[0][2],c=0-(r<0&&n?i-Math.abs(r):r),d=0,p=E(M),v=p.abs,b=p.rel,x=o[b][2],k=o.map((function(t,e){var r=c+d;(r<0-t[0]||r>1)&&(r+=(Math.abs(r)>i-1&&n?i:0)*l(-r));var o=e-b,s=Math.sign(o),f=o+v;n&&(-1===s&&r>x&&(f+=u),1===s&&r<x&&(f-=u),null!==m&&f<m&&(r+=i),null!==h&&f>h&&(r-=i));var p=r+t[0]+t[1],g=Math.max(r>=0&&p<=1?1:p<0||r>1?0:r<0?Math.min(1,(t[0]+r)/t[0]):(1-r)/t[0],0);return d+=t[0]+t[1],{abs:f,distance:a.rtl?-1*r+1-t[0]:r,portion:g,size:t[0]}}));return v=D(v),b=L(v),{abs:D(v),length:e,max:y,maxIdx:f,min:g,minIdx:s,position:M,progress:n?t/i:M/e,rel:b,slides:k}}}();return t.details=c,n.emit("detailsChanged"),c}return t={absToRel:L,add:T,details:null,distToIdx:C,idxToDist:z,init:function(t){if(function(){if(a=n.options,o=(a.trackConfig||[]).map((function(n){return[p(n,"size",1),p(n,"spacing",0),p(n,"origin",0)]})),u=o.length){i=v(o.reduce((function(n,t){return n+t[0]+t[1]}),0));var t=u-1;e=v(i+o[0][2]-o[t][0]-o[t][2]-o[t][1]),(c=o.reduce((function(n,t){if(!n)return[0];var i=o[n.length-1],e=n[n.length-1]+(i[0]+i[2])+i[1];return e-=t[2],n[n.length-1]>e&&(e=n[n.length-1]),n.push(e),n}),null)).push(i)}}(),!u)return P(!0);var r;!function(){var t=n.options.range,i=n.options.loop;m=s=i?p(i,"min",-1/0):0,h=f=i?p(i,"max",x):o.length-1;var e=p(t,"min",null),r=p(t,"max",null);e&&(s=e),r&&(f=r),g=s===-1/0?s:n.track.idxToDist(s||0,!0,0),y=f===x?f:z(f,!0,0),null===r&&(h=f),p(t,"align",!1)&&f!==x&&0===o[L(f)][2]&&(y-=1-o[L(f)][0],f=C(y)),g=v(g),y=v(y)}(),r=t,Number(r)===r?T(I(D(t))):P()},to:O,velocity:function(){var n=r(),t=k.reduce((function(t,i){var e=i.distance,r=i.timestamp;return n-r>200||(l(e)!==l(t.distance)&&t.distance&&(t={distance:0,lastTimestamp:0,time:0}),t.time&&(t.distance+=e),t.lastTimestamp&&(t.time+=r-t.lastTimestamp),t.lastTimestamp=r),t}),{distance:0,lastTimestamp:0,time:0});return t.distance/t.time||0}}}function k(n){var t,i,e,r,a,o,u;function c(n){return 2*n}function s(n){return d(n,o,u)}function f(n){return 1-Math.pow(1-n,3)}function p(){h();var t="free-snap"===n.options.mode,i=n.track,o=i.velocity();e=l(o);var u=n.track.details,d=[];if(o||!t){var p=v(o),m=p.dist,g=p.dur;if(g=c(g),m*=e,t){var b=i.idxToDist(i.distToIdx(m),!0);b&&(m=b)}d.push({distance:m,duration:g,easing:f});var y=u.position,x=y+m;if(x<r||x>a){var k=x<r?r-y:a-y,w=0,M=o;if(l(k)===e){var T=Math.min(Math.abs(k)/Math.abs(m),1),C=function(n){return 1-Math.pow(1-n,1/3)}(T)*g;d[0].earlyExit=C,M=o*(1-T)}else d[0].earlyExit=0,w+=k;var E=v(M,100),z=E.dist*e;n.options.rubberband&&(d.push({distance:z,duration:c(E.dur),easing:f}),d.push({distance:-z+w,duration:500,easing:f}))}n.animator.start(d)}else n.moveToIdx(s(u.abs),!0,{duration:500,easing:function(n){return 1+--n*n*n*n*n}})}function v(n,t){void 0===t&&(t=1e3);var i=147e-9+(n=Math.abs(n))/t;return{dist:Math.pow(n,2)/i,dur:n/i}}function m(){var t=n.track.details;t&&(r=t.min,a=t.max,o=t.minIdx,u=t.maxIdx)}function h(){n.animator.stop()}n.on("updated",m),n.on("optionsChanged",m),n.on("created",m),n.on("dragStarted",(function(){h(),t=i=n.track.details.abs})),n.on("dragEnded",(function(){var e=n.options.mode;"snap"===e&&function(){var e=n.track,o=n.track.details,u=o.position,c=l(e.velocity());(u>a||u<r)&&(c=0);var d=t+c;0===o.slides[e.absToRel(d)].portion&&(d-=c),t!==i&&(d=i),l(e.idxToDist(d,!0))!==c&&(d+=c),d=s(d);var f=e.idxToDist(d,!0);n.animator.start([{distance:f,duration:500,easing:function(n){return 1+--n*n*n*n*n}}])}(),"free"!==e&&"free-snap"!==e||p()})),n.on("dragged",(function(){i=n.track.details.abs}))}function w(n){var t,i,e,r,f,p,v,m,h,g,b,y,x,k,w,M,T,C,E=s();function z(o){if(p&&m===o.id){var s=S(o);if(h){if(!D(o))return A(o);g=s,h=!1,n.emit("dragChecked")}if(M)return g=s;u(o);var x=function(t){if(T===-1/0&&C===1/0)return t;var e=n.track.details,a=e.length,o=e.position,u=d(t,T-o,C-o);if(0===a)return 0;if(!n.options.rubberband)return u;if(o<=C&&o>=T)return t;if(o<T&&i>0||o>C&&i<0)return t;var c=(o<T?o-T:o-C)/a,s=r*a,l=Math.abs(c*s),p=Math.max(0,1-l/f*2);return p*p*t}(v(g-s)/r*e);i=l(x);var k=n.track.details.position;(k>T&&k<C||k===T&&i>0||k===C&&i<0)&&c(o),b+=x,!y&&Math.abs(b*r)>5&&(y=!0,a(t,"moves","")),n.track.add(x),g=s,n.emit("dragged")}}function I(t){!p&&n.track.details&&n.track.details.length&&(y=!1,b=0,p=!0,h=!0,m=t.id,D(t),g=S(t),n.emit("dragStarted"))}function A(i){p&&m===i.idChanged&&(a(t,"moves",null),p=!1,n.emit("dragEnded"))}function D(n){var t=L(),i=t?n.y:n.x,e=t?n.x:n.y,r=void 0!==x&&void 0!==k&&Math.abs(k-e)<=Math.abs(x-i);return x=i,k=e,r}function S(n){return L()?n.y:n.x}function L(){return n.options.vertical}function O(){r=n.size,f=L()?window.innerHeight:window.innerWidth;var t=n.track.details;t&&(T=t.min,C=t.max)}function P(){if(E.purge(),n.options.drag&&!n.options.disabled){var i;i=n.options.dragSpeed||1,v="function"==typeof i?i:function(n){return n*i},e=n.options.rtl?-1:1,O(),t=n.container,function(){var n="data-keen-slider-clickable";o("[".concat(n,"]:not([").concat(n,"=false])"),t).map((function(n){E.add(n,"mousedown",c),E.add(n,"touchstart",c)}))}(),E.add(t,"dragstart",(function(n){u(n)})),E.input(t,"ksDragStart",I),E.input(t,"ksDrag",z),E.input(t,"ksDragEnd",A),E.input(t,"mousedown",I),E.input(t,"mousemove",z),E.input(t,"mouseleave",A),E.input(t,"mouseup",A),E.input(t,"touchstart",I,{passive:!0}),E.input(t,"touchmove",z,{passive:!1}),E.input(t,"touchend",A),E.input(t,"touchcancel",A),E.add(window,"wheel",(function(n){p&&u(n)}));var r="data-keen-slider-scrollable";o("[".concat(r,"]:not([").concat(r,"=false])"),n.container).map((function(n){return function(n){var t;E.input(n,"touchstart",(function(n){t=S(n),M=!0,w=!0}),{passive:!0}),E.input(n,"touchmove",(function(i){var e=L(),r=e?n.scrollHeight-n.clientHeight:n.scrollWidth-n.clientWidth,a=t-S(i),o=e?n.scrollTop:n.scrollLeft,c=e&&"scroll"===n.style.overflowY||!e&&"scroll"===n.style.overflowX;if(t=S(i),(a<0&&o>0||a>0&&o<r)&&w&&c)return M=!0;w=!1,u(i),M=!1})),E.input(n,"touchend",(function(){M=!1}))}(n)}))}}n.on("updated",O),n.on("optionsChanged",P),n.on("created",P),n.on("destroyed",E.purge)}function M(n){var t,i,e=null;function r(t,i,e){n.animator.active?o(t,i,e):requestAnimationFrame((function(){return o(t,i,e)}))}function a(){r(!1,!1,i)}function o(i,r,a){var o=0,s=n.size,d=n.track.details;if(d&&t){var l=d.slides;t.forEach((function(n,t){if(i)!e&&r&&u(n,null,a),c(n,null,a);else{if(!l[t])return;var d=l[t].size*s;!e&&r&&u(n,d,a),c(n,l[t].distance*s-o,a),o+=d}}))}}function u(n,t,i){var e=i?"height":"width";null!==t&&(t+="px"),n.style["min-"+e]=t,n.style["max-"+e]=t}function c(t,i,e){if(null!==i){"performance"===n.options.renderMode&&(i=Math.round(i));var r=e?i:0;i="translate3d(".concat(e?0:i,"px, ").concat(r,"px, 0)")}t.style.transform=i,t.style["-webkit-transform"]=i}function s(){t&&r(!0,!0,i),n.on("detailsChanged",a,!0)}function d(){r(!1,!0,i)}function l(){s(),i=n.options.vertical,n.options.disabled||"custom"===n.options.renderMode||(e="auto"===p(n.options.slides,"perView",null),n.on("detailsChanged",a),(t=n.slides).length&&d())}n.on("created",l),n.on("optionsChanged",l),n.on("updated",d),n.on("destroyed",s)}function T(n,t){return function(i){var e,r,u,c,d,l,v=s();function m(n){var t;a(i.container,"reverse","rtl"!==(t=i.container,window.getComputedStyle(t,null).getPropertyValue("direction"))||n?null:""),a(i.container,"v",i.options.vertical&&!n?"":null),a(i.container,"disabled",i.options.disabled&&!n?"":null)}function h(){b()&&M()}function b(){var n=null;if(c.forEach((function(t){t.matches&&(n=t.__media)})),n===e)return!1;e=n;var t=n?u.breakpoints[n]:u;return i.options=g(g({},u),t),m(),I(),A(),C(),!0}function y(n){var t=f(n);return(i.options.vertical?t.height:t.width)/i.size||1}function x(){return i.options.trackConfig.length}function k(n){for(var a in e=!1,u=g(g({},t),n),v.purge(),r=i.size,c=[],u.breakpoints||[]){var o=window.matchMedia(a);o.__media=a,c.push(o),v.add(o,"change",h)}v.add(window,"orientationchange",z),v.add(window,"resize",E),b()}function w(n){i.animator.stop();var t=i.track.details;i.track.init(null!=n?n:t?t.abs:0)}function M(n){w(n),i.emit("optionsChanged")}function T(n,t){if(n)return k(n),void M(t);I(),A();var e=x();C(),x()!==e?M(t):w(t),i.emit("updated")}function C(){var n=i.options.slides;if("function"==typeof n)return i.options.trackConfig=n(i.size,i.slides);for(var t=i.slides,e=t.length,r="number"==typeof n?n:p(n,"number",e,!0),a=[],o=p(n,"perView",1,!0),u=p(n,"spacing",0,!0)/i.size||0,c="auto"===o?u:u/o,s=p(n,"origin","auto"),d=0,l=0;l<r;l++){var f="auto"===o?y(t[l]):1/o-u+c,v="center"===s?.5-f/2:"auto"===s?0:s;a.push({origin:v,size:f,spacing:u}),d+=f}if(d+=u*(r-1),"auto"===s&&!i.options.loop&&1!==o){var m=0;a.map((function(n){var t=d-m;return m+=n.size+u,t>=1||(n.origin=1-t-(d>1?0:1-d)),n}))}i.options.trackConfig=a}function E(){I();var n=i.size;i.options.disabled||n===r||(r=n,T())}function z(){E(),setTimeout(E,500),setTimeout(E,2e3)}function I(){var n=f(i.container);i.size=(i.options.vertical?n.height:n.width)||1}function A(){i.slides=o(i.options.selector,i.container)}i.container=(l=o(n,d||document)).length?l[0]:null,i.destroy=function(){v.purge(),i.emit("destroyed"),m(!0)},i.prev=function(){i.moveToIdx(i.track.details.abs-1,!0)},i.next=function(){i.moveToIdx(i.track.details.abs+1,!0)},i.update=T,k(i.options)}}var C=function(n,t,i){try{return function(n,t){var i,e={};return i={emit:function(n){e[n]&&e[n].forEach((function(n){n(i)}));var t=i.options[n];t&&t(i)},moveToIdx:function(n,t,e){var r=i.track.idxToDist(n,t);if(r){var a=i.options.defaultAnimation;i.animator.start([{distance:r,duration:p(e||a,"duration",500),easing:p(e||a,"easing",(function(n){return 1+--n*n*n*n*n}))}])}},on:function(n,t,i){void 0===i&&(i=!1),e[n]||(e[n]=[]);var r=e[n].indexOf(t);r>-1?i&&delete e[n][r]:i||e[n].push(t)},options:n},function(){if(i.track=x(i),i.animator=y(i),t)for(var n in t){var e=t[n];e&&e(i)}i.track.init(i.options.initial||0),i.emit("created")}(),i}(t,b([T(n,{drag:!0,mode:"snap",renderMode:"precision",rubberband:!0,selector:".keen-slider__slide"}),M,w,k],i||[],!0))}catch(n){console.error(n)}};function E(e,r){var a=n(null),o=n(!1),u=n(e),c=t((function(n){n?(u.current=e,a.current=new C(n,e,r),o.current=!1):(a.current&&a.current.destroy&&a.current.destroy(),a.current=null)}),[]);return i((function(){o.current?a.current&&a.current.update(u.current):o.current=!0}),[h(u,e)]),[c,a]}export{E as useKeenSlider};
